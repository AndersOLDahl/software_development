<div id="admin-panel">
    <% if user_signed_in? %>
        <%= form_for @microsite, url: create_microsite_path do |f| %>
            <% flash.each do |key, value| %>
                <%= content_tag :div, value, class: "flash #{key}" %>
            <% end %>
            <p>
            <%= f.label :microsite_id %><br>
            <%= f.text_field :microsite_id %>
            </p>

            <p>
            <%= f.label :site %><br>
            <%= f.text_field :site %>
            </p>

            <p>
            <%= f.label :field_lat %><br>
            <%= f.text_field :field_lat %>
            </p>

            <p>
            <%= f.label :field_lon %><br>
            <%= f.text_field :field_lon %>
            </p>

            <p>
            <%= f.label :location %><br>
            <%= f.text_field :location %>
            </p>

            <p>
            <%= f.label :country %><br>
            <%= f.country_select :country %>
            </p>

            <p>
            <%= f.label :state_province %><br>
            <%= f.text_field :state_province %>
            </p>

            <p>
            <%= f.label :biomimic %><br>
            <%= f.select :biomimic, options_for_select(["Barnacle", "Coral", "Mussel", "Sea Star"]) %>
            </p>

            <p>
            <%= f.label :zone %><br>
            <%= f.text_field :zone %>
            </p>

            <p>
            <%= f.label :sub_zone %><br>
            <%= f.select :sub_zone, options_for_select(["Backreef", "Forereef", "High", "High Mid", "Lagoon", "Low", "Low Mid", "Mid", "Terr"])  %>
            </p>

            <p>
            <%= f.label :wave_exp %><br>
            <%= f.select :wave_exp, options_for_select(["Exposed", "Intermediate",         "Moderately Exposed", "Protected"]) %>
            </p>

            <p>
            <%= f.label :tide_height %><br>
            <%= f.text_field :tide_height %>
            </p>

            <p>
            <%= f.submit %>
            </p>

        <% end %>
        <%= form_for(:microsite, url: destroy_microsite_path, html: { multipart: true }) do |f| %>
            <%= f.select :id, options_for_select(Microsite.all.collect {|m| [m.microsite_id, m.id]}.sort) %>
            <%= f.submit "Destroy Microsite" %>
        <% end %>
        <%= form_for(:reading, url: upload_readings_path, html: { multipart: true }) do |f| %>
            <%= select_tag :microsite_id, options_for_select(Microsite.all.collect {|m| [m.microsite_id, m.id]}.sort) %>
            <%= select_tag :date_format, options_for_select(["DayMonthYear", "MonthDayYear", "YearMonthDay"]) %>
            <%= file_field(:file, :data, accept: "text/plain") %>
            <%= submit_tag "Upload text File" %>
        <% end %>
    <% end %>
</div>

<header>
    <h1>Helmuth Lab Database</h1>

    <% if user_signed_in? %>
        <div id="admin-login" class="logged-in">
            <span id="current-user"><%= current_user.email %></span>
            <%= link_to('Log Out', destroy_user_session_path, method: :delete, class: "generic-button") %>
        </div>
    <% else %>
        <div id="admin-login" class="logged-out">
            <%= link_to('Log In', new_user_session_path, class: "generic-button") %>
        </div>
    <% end %>
</header>

<div id="map" data-microsites="<%= @hash.to_json %>"></div>

<% if false %>
<div id="filters"
<%# Commented out just in case we need it again. %>
    <%= select(:microsite, :site, @sites, {:prompt => "Site"}, {:multiple => true, :class => "select", :id => "site"}) %>
    <%= select(:microsite, :country, @country, {:prompt => "Country"}, {:multiple => true, :class => "select", :id => "country"}) %>
    <%= select(:microsite, :state_province, @state_province, {:prompt => "State/Province"}, {:multiple => true, :class => "select", :id => "state_province"}) %>
    <%= select(:microsite, :zone, @zone, {:prompt => "Zone"}, {:multiple => true, :class => "select", :id => "zone"}) %>
    <%= select(:microsite, :sub_zone, @sub_zone, {:prompt => "SubZone"}, {:multiple => true, :class => "select", :id => "sub_zone"}) %>
</div>
<% end %>

<div id="export-options">
    <%= link_to('Export CSV', {controller: "readings", format: :csv}, class: "generic-button")%>
</div>

<h1>Listing microsites</h1>

<table>
  <tr>
    <th>Mircosite Id</th>
    <th>Site</th>
    <th>Field Lat</th>
    <th>Field Lon</th>
    <th>Location</th>
    <th>Country</th>
    <th>State Province</th>
    <th>Biomimic</th>
    <th>Sub Zone</th>
    <th>Wave Exp</th>
  </tr>

<% @search_data.each do |microsite| %>
  <tr>
    <td><%= microsite.microsite_id %></td>
    <td><%= microsite.site %></td>
    <td><%= microsite.field_lat %></td>
    <td><%= microsite.field_lon %></td>
    <td><%= microsite.location %></td>
    <td><%= microsite.country %></td>
    <td><%= microsite.state_province %></td>
    <td><%= microsite.biomimic %></td>
    <td><%= microsite.sub_zone %></td>
    <td><%= microsite.wave_exp %></td>
  </tr>
<% end %>
</table>

<br />
<% if @search.pages > 1 %>
    <p>There are <%= @search.pages %> pages in total </p>
<% end %>
<br />

<%= form_for @search, :url => "/pages/home" do |f| %>
    <%= f.label 'Microsite ID' %><br>
    <%= f.text_field 'microsite_id' %><br>
    <%= f.label 'Site' %><br>
    <%= f.text_field 'site' %><br>
    <%= f.label 'Field Lat' %><br>
    <%= f.text_field 'field_lat' %><br>
    <%= f.label 'Field Lon' %><br>
    <%= f.text_field 'field_lon' %><br>
    <%= f.label 'Location' %><br>
    <%= f.text_field 'location' %><br>
    <%= f.label 'Country' %><br>
    <%= f.select :country, @country, {:prompt => "Country"}, {:multiple => true, :class => "select", :id => "country"} %><br>
    <%= f.label 'State Province' %><br>
    <%= f.text_field 'state_province' %><br>
    <%= f.label 'Biomimic' %><br>
    <%= f.select :biomimic, @biomimic, {:prompt => "Biomimic"}, {:multiple => true, :class => "select", :id => "biomimic"} %><br>
    <%= f.label 'Zone' %><br>
    <%= f.text_field :zone %><br>
    <%= f.label :sub_zone %><br>
    <%= f.select :sub_zone, @sub_zone, {:prompt => "SubZone"}, {:multiple => true, :class => "select", :id => "sub_zone"} %><br>
    <%= f.label :wave_exp %><br>
    <%= f.select :wave_exp, @wave_exp, {:prompt => "Wave Exposure"}, {:multiple => true, :class => "select", :id => "wave_exp"} %><br>
    <%= f.submit "search" %>
<% end %>
